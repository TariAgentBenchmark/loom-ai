# LoomAI Backend

LoomAI åç«¯APIæœåŠ¡ï¼Œæä¾›AIå›¾æ¡ˆå¤„ç†åŠŸèƒ½ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.11+
- uv (PythonåŒ…ç®¡ç†å™¨)
- Redis (å¯é€‰ï¼Œç”¨äºä»»åŠ¡é˜Ÿåˆ—)

### å®‰è£…å’Œå¯åŠ¨

1. **å®‰è£…uvåŒ…ç®¡ç†å™¨**:
```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

2. **å…‹éš†é¡¹ç›®å¹¶è¿›å…¥ç›®å½•**:
```bash
cd backend
```

3. **è¿è¡Œå¯åŠ¨è„šæœ¬**:
```bash
chmod +x start.sh
./start.sh
```

æˆ–è€…æ‰‹åŠ¨æ‰§è¡Œï¼š

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
uv venv

# å®‰è£…ä¾èµ–
uv pip install -e .

# é…ç½®ç¯å¢ƒå˜é‡
cp env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®å¿…è¦çš„APIå¯†é’¥

# åˆå§‹åŒ–æ•°æ®åº“
uv run python -c "from app.core.database import init_db; init_db()"

# å¯åŠ¨æœåŠ¡
uv run uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

### è®¿é—®åœ°å€

- **APIæœåŠ¡**: http://localhost:8000
- **APIæ–‡æ¡£**: http://localhost:8000/docs
- **å¥åº·æ£€æŸ¥**: http://localhost:8000/health

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

å¤åˆ¶ `env.example` ä¸º `.env` å¹¶é…ç½®ä»¥ä¸‹å…³é”®å˜é‡ï¼š

```bash
# å¿…é¡»é…ç½®
SECRET_KEY=your-secret-key-here
APIYI_API_KEY=your-apiyi-api-key-here
GQCH_API_KEY=your-gqch-api-key-here
RUNNINGHUB_API_KEY=your-runninghub-api-key
RUNNINGHUB_WORKFLOW_ID_POSITIONING=your-runninghub-workflow-id

# å¯é€‰é…ç½®
DATABASE_URL=sqlite:///./loom_ai.db
REDIS_URL=redis://localhost:6379/0
```

### APIå¯†é’¥è·å–

- **Apyi API**: åœ¨ https://api.apiyi.com è·å–APIå¯†é’¥
- æ”¯æŒGPT-4oå›¾åƒç”Ÿæˆå’ŒGemini-2.5-flash-imageå¤„ç†
- æ”¯æŒOpenAIå…¼å®¹çš„å›¾åƒç¼–è¾‘å’Œå¯¹è¯åŠŸèƒ½
- **RunningHub**: åœ¨ https://www.runninghub.cn æ§åˆ¶å°è·å– API Key ä¸ workflowIdï¼Œç”¨äºçº¿æ¡/çŸ¢é‡å·¥ä½œæµä¸VR2å®Œç¾æ”¾å¤§é«˜æ¸…æµç¨‹

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### AIå›¾ç‰‡å¤„ç†åŠŸèƒ½

| åŠŸèƒ½ | ç«¯ç‚¹ | ç®—åŠ›æ¶ˆè€— | è¯´æ˜ |
|------|------|----------|------|
| AIå››æ–¹è¿ç»­è½¬æ¢ | `POST /v1/processing/seamless` | 60 | çŸ©å½¢å›¾è½¬å››æ–¹è¿ç»­ |
| AIçŸ¢é‡åŒ– | `POST /v1/processing/vectorize` | 100 | å›¾ç‰‡è½¬SVGçŸ¢é‡å›¾ |
| AIæå–èŠ±å‹ | `POST /v1/processing/extract-pattern` | 100 | èŠ±å‹å…ƒç´ æå– |
| AIæ™ºèƒ½å»æ°´å° | `POST /v1/processing/remove-watermark` | 70 | æ°´å°å»é™¤ |
| AIå¸ƒçº¹å»å™ª | `POST /v1/processing/denoise` | 80 | å™ªç‚¹å¸ƒçº¹æ¸…ç† |
| AIæ¯›çº¿åˆºç»£å¢å¼º | `POST /v1/processing/embroidery` | 90 | åˆºç»£æ•ˆæœå¤„ç† |

### æ”¯æ’‘åŠŸèƒ½

- **ç”¨æˆ·è®¤è¯**: æ³¨å†Œã€ç™»å½•ã€Tokenç®¡ç†
- **ç®—åŠ›ç³»ç»Ÿ**: ä½™é¢ç®¡ç†ã€æ¶ˆè€—è®°å½•ã€è½¬èµ åŠŸèƒ½
- **æ–‡ä»¶ç®¡ç†**: ä¸Šä¼ ã€å­˜å‚¨ã€ä¸‹è½½
- **å†å²è®°å½•**: å¤„ç†å†å²ã€æ”¶è—ç®¡ç†
- **æ”¯ä»˜ç³»ç»Ÿ**: å¥—é¤è´­ä¹°ã€è®¢å•ç®¡ç†

## ğŸ“ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/                 # APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ v1/             # API v1ç‰ˆæœ¬
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py     # è®¤è¯ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ processing.py # å›¾ç‰‡å¤„ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ credits.py  # ç®—åŠ›ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ dependencies.py # ä¾èµ–æ³¨å…¥
â”‚   â”‚   â””â”€â”€ routes.py       # è·¯ç”±æ±‡æ€»
â”‚   â”œâ”€â”€ core/               # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ config.py       # åº”ç”¨é…ç½®
â”‚   â”‚   â””â”€â”€ database.py     # æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ models/             # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ user.py         # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ task.py         # ä»»åŠ¡æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ credit.py       # ç®—åŠ›æ¨¡å‹
â”‚   â”‚   â””â”€â”€ payment.py      # æ”¯ä»˜æ¨¡å‹
â”‚   â”œâ”€â”€ schemas/            # Pydanticæ¨¡å¼
â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ ai_client.py    # AIæœåŠ¡å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ auth_service.py # è®¤è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ processing_service.py # å¤„ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ credit_service.py # ç®—åŠ›æœåŠ¡
â”‚   â”‚   â””â”€â”€ file_service.py # æ–‡ä»¶æœåŠ¡
â”‚   â””â”€â”€ main.py            # åº”ç”¨å…¥å£
â”œâ”€â”€ uploads/               # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”œâ”€â”€ tests/                # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ pyproject.toml        # é¡¹ç›®é…ç½®
â”œâ”€â”€ env.example           # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â””â”€â”€ start.sh             # å¯åŠ¨è„šæœ¬
```

## ğŸ”§ å¼€å‘è¯´æ˜

### æ•°æ®åº“

- é»˜è®¤ä½¿ç”¨SQLiteï¼Œé€‚åˆå¼€å‘å’Œå°è§„æ¨¡éƒ¨ç½²
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨PostgreSQL
- è‡ªåŠ¨åˆ›å»ºè¡¨ç»“æ„ï¼Œæ— éœ€æ‰‹åŠ¨å»ºè¡¨

### AIæœåŠ¡é›†æˆ

- **GPT-4o**: ç”¨äºå›¾åƒç”Ÿæˆå’Œå¤æ‚å¤„ç†
- **Gemini-2.5-flash-image**: ç”¨äºå›¾åƒç¼–è¾‘å’Œåˆ†æ
- æ”¯æŒå¼‚æ­¥å¤„ç†ï¼Œæé«˜å“åº”é€Ÿåº¦

### æ–‡ä»¶å­˜å‚¨

- æœ¬åœ°å­˜å‚¨ï¼šé€‚åˆå¼€å‘ç¯å¢ƒ
- æ”¯æŒAWS S3ï¼šé€‚åˆç”Ÿäº§ç¯å¢ƒ
- è‡ªåŠ¨ç”Ÿæˆç¼©ç•¥å›¾å’Œé¢„è§ˆ

### ä»»åŠ¡é˜Ÿåˆ—

- ä½¿ç”¨Celery + Rediså®ç°å¼‚æ­¥ä»»åŠ¡å¤„ç†
- æ”¯æŒä»»åŠ¡çŠ¶æ€æŸ¥è¯¢å’Œè¿›åº¦è·Ÿè¸ª
- è‡ªåŠ¨é‡è¯•å’Œé”™è¯¯å¤„ç†

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œæµ‹è¯•
uv run pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•
uv run pytest tests/test_auth.py

# ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
uv run pytest --cov=app --cov-report=html
```

## ğŸ“– APIæ–‡æ¡£

è¯¦ç»†çš„APIæ–‡æ¡£è¯·æŸ¥çœ‹ `docs/api/` ç›®å½•ï¼š

- [APIæ€»è§ˆ](../docs/api/README.md)
- [è®¤è¯ç®¡ç†](../docs/api/auth.md)
- [å›¾ç‰‡å¤„ç†](../docs/api/processing.md)
- [ç®—åŠ›ç®¡ç†](../docs/api/credits.md)
- [ç”¨æˆ·ç®¡ç†](../docs/api/user.md)
- [æ”¯ä»˜ç®¡ç†](../docs/api/payment.md)
- [å†å²è®°å½•](../docs/api/history.md)

## ğŸš€ éƒ¨ç½²

### Dockeréƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t loom-ai-backend .

# è¿è¡Œå®¹å™¨
docker run -p 8000:8000 -e TUZI_API_KEY=your-key loom-ai-backend
```

### ç”Ÿäº§ç¯å¢ƒé…ç½®

1. ä½¿ç”¨PostgreSQLæ•°æ®åº“
2. é…ç½®Redisç”¨äºä»»åŠ¡é˜Ÿåˆ—
3. ä½¿ç”¨AWS S3å­˜å‚¨æ–‡ä»¶
4. é…ç½®HTTPSå’ŒåŸŸå
5. è®¾ç½®ç›‘æ§å’Œæ—¥å¿—

## ğŸ” ç›‘æ§å’Œæ—¥å¿—

- å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼š`GET /health`
- æ—¥å¿—çº§åˆ«å¯é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®
- æ”¯æŒç»“æ„åŒ–æ—¥å¿—è¾“å‡º

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥DATABASE_URLé…ç½®
   - ç¡®ä¿æ•°æ®åº“æœåŠ¡æ­£åœ¨è¿è¡Œ

2. **AI APIè°ƒç”¨å¤±è´¥**
   - æ£€æŸ¥TUZI_API_KEYæ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸

3. **æ–‡ä»¶ä¸Šä¼ å¤±è´¥**
   - æ£€æŸ¥uploadsç›®å½•æƒé™
   - ç¡®è®¤ç£ç›˜ç©ºé—´å……è¶³

4. **Redisè¿æ¥å¤±è´¥**
   - æ£€æŸ¥REDIS_URLé…ç½®
   - ç¡®ä¿RedisæœåŠ¡æ­£åœ¨è¿è¡Œ

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/app.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f logs/error.log
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- **GitHub Issues**: æäº¤bugæŠ¥å‘Šå’ŒåŠŸèƒ½è¯·æ±‚
- **æŠ€æœ¯æ”¯æŒ**: tech@loom-ai.com
- **APIé—®é¢˜**: api@loom-ai.com

---

**ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2023-12-01
